:javascript
  var tag_count = 0;
  var tag_html = '#{escape_javascript(render(:partial => "tags/tag", :locals => {:tag_name => "%1", :controls => true} ))}'

  $(document).ready(function() {
    $('#tagger').keydown(function(event) {
      if(event.keyCode == '13') {
        var elem = $(this);
        var val = elem.val().replace(/[^\w|\-|а-яА-Я]/g,"");
        if (val.length > 0) {
          addTag(val);
          elem.val('');
        }
      }
    });
  });

  function addTag(name) {
    //$('input[rel="tag"][value="'+name+'"]')
    $('<input rel="tag" type="hidden" name="tag[' + tag_count++ + ']" value="' + name + '"/>').appendTo('.post_form');
    $('#tags_block').append(tag_html.replace(/%1/, name));
    appendOptionIfNotExist('#tagger', name);
  }

#tags_controls.fl
  %label Tags
  %p.sub Press 'Enter' for add tag
  %input#tagger{"data-source" => "#{@tags.inspect}", :type => "text", "data-provide" => "typeahead" }

#tags_block.fl
.cb
